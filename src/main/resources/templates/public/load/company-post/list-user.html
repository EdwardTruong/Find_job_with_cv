<!DOCTYPE html>
<html lang="en" 
		xmlns:th="http://www.thymeleaf.org"
		xmlns:sec="http://www.thymeleaf.org">
<head>
<title>Work CV</title>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link
	href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700&display=swap"
	rel="stylesheet">
<!-- CSS -->
<link rel="stylesheet"
	th:href="@{/assets/css/open-iconic-bootstrap.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/animate.css}">
<link rel="stylesheet" th:href="@{/assets/css/owl.carousel.min.css}">
<link rel="stylesheet"
	th:href="@{/assets/css/owl.theme.default.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/magnific-popup.css}">
<link rel="stylesheet" th:href="@{/assets/css/owl.carousel.min.css}">
<link rel="stylesheet"
	th:href="@{/assets/css/owl.theme.default.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/aos.css}">
<link rel="stylesheet" th:href="@{/assets/css/ionicons.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/bootstrap-datepicker.css}">
<link rel="stylesheet" th:href="@{/assets/css/jquery.timepicker.css}">
<link rel="stylesheet" th:href="@{/assets/css/css/bootstrap-reboot.css}">
<link rel="stylesheet"
	th:href="@{/assets/css/css/mixins/_text-hide.css}">
<link rel="stylesheet" th:href="@{/assets/css/flaticon.css}">
<link rel="stylesheet" th:href="@{/assets/css/icomoon.css}">
<link rel="stylesheet" th:href="@{/assets/css/style.css}">
<link rel="stylesheet"
	th:href="@{/assets/css/bootstrap/bootstrap-grid.css}">
<link rel="stylesheet"
	th:href="@{/assets/css/bootstrap/bootstrap-reboot.css}">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
	rel="stylesheet" />

<!-- JS -->
<script th:src="@{/assets/js/jquery.min.js}"></script>
<script th:src="@{/assets/js/jquery-migrate-3.0.1.min.js}"></script>
<script th:src="@{/assets/js/popper.min.js}"></script>
<script th:src="@{/assets/js/bootstrap.min.js}"></script>
<script th:src="@{/assets/js/jquery.easing.1.3.js}"></script>
<script th:src="@{/assets/js/jquery.waypoints.min.js}"></script>
<script th:src="@{/assets/js/jquery.stellar.min.js}"></script>
<script th:src="@{/assets/js/owl.carousel.min.js}"></script>
<script th:src="@{/assets/js/jquery.magnific-popup.min.js}"></script>
<script th:src="@{/assets/js/aos.js}"></script>
<script th:src="@{/assets/js/jquery.animateNumber.min.js}"></script>
<script th:src="@{/assets/js/scrollax.min.js}"></script>
<script
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
<script th:src="@{/assets/js/google-map.js}"></script>
<script th:src="@{/assets/js/main.js}"></script>
<script
	src="https://cdn.ckeditor.com/ckeditor5/29.0.0/classic/ckeditor.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
	crossorigin="anonymous"></script>

</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
		<div class="container-fluid px-md-4">
			<a sec:authorize="!isAuthenticated()" class="navbar-brand" th:href="@{/}">HOME - WOKING CV</a>
            <a sec:authorize="isAuthenticated()" class="navbar-brand" th:href="@{/home}">HOME - WOKING CV</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse"
				data-target="#ftco-nav" aria-controls="ftco-nav"
				aria-expanded="false" aria-label="Toggle navigation">
				<span class="oi oi-menu"></span> Menu
			</button>
			<div class="collapse navbar-collapse" id="ftco-nav">
				<ul class="navbar-nav ml-auto">
				    <li sec:authorize="!isAuthenticated()" class="nav-item"><a th:href="@{/}" class="nav-link">Trang chủ</a></li>
                    <li sec:authorize="isAuthenticated()" class="nav-item"><a th:href="@{/home}" class="nav-link">Trang chủ</a></li>
                    <li class="nav-item"><a th:href="@{/jobs}" class="nav-link">Công việc</a></li> 
					<li class="nav-item dropdown" sec:authorize="hasRole('ROLE_USER')">
						<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" th:text="${user.fullName}"></a>
						<ul class="dropdown-menu dropdown2">
							<li><a th:href="@{/user/profile}">Hồ Sơ</a></li>
            				<li><a th:href=@{/save-job/get-list} >Công việc đã lưu</a></li>
            				<li><a th:href="@{/apply/get-list}" >Công việc đã ứng tuyển</a></li>
            				<li><a th:href=@{/follow/get-list} >Công ty đã theo dõi</a></li>
						</ul>
					</li>
					<li sec:authorize="hasRole('ROLE_COMPANY')"class="nav-link" th:text="${company.name}"></li>	
					<li sec:authorize="hasRole('ROLE_COMPANY')" class="nav-item dropdown ">
						<a href="#" class="nav-link dropdown-toggle active" data-toggle="dropdown">Danh sách bài đăng</a>
              <ul class="dropdown-menu dropdown2">
                  <li><a th:href="@{/company/profile}">Hồ Sơ</a></li>
                  <li><a th:href="@{/recruitment/list-post}" >Danh sách bài đăng</a></li>
                  <li><a th:href="@{/recruitment/post}">Đăng tuyển</a> </li>
                  <li><a th:href="@{/apply/list-user}" >Ứng cử viên tiềm năng</a></li>
                </ul>
					</li>	
					 <li sec:authorize="isAuthenticated()" class="nav-item cta cta-colored"><a th:href="@{/auth/logout}" class="nav-link">Đăng xuất</a></li>
                    <li sec:authorize="!isAuthenticated()" class="nav-item cta cta-colored"><a th:href="@{/auth/login}" class="nav-link">Đăng nhập</a></li>
                </ul>
			</div>
		</div>
	</nav>
 <!-- END nav -->
<div th:if="${success}" class="toast" data-delay="2000" style="position:fixed;top: 100PX; right: 10PX;z-index: 2000;width: 300px">
  <script>
    swal({
      title: 'Ứng cử viên này chưa cập nhật cv!',
      /* text: 'Redirecting...', */
      icon: 'error',
      timer: 3000,
      buttons: true,
      type: 'error'
    })
  </script>
</div>

 <!-- User can't see ! -->
 <section sec:authorize="hasRole('ROLE_USER')">
    <div class="hero-wrap hero-wrap-2" th:style="'background-image: url('+@{/assets/images/bg_1.jpg}+');'" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
               <div class="row no-gutters slider-text align-items-end justify-content-start">
                   <div class="col-md-12 text-center mb-5">
                    <h1 class="mb-3 bread" >Không tìm thấy trang yêu cầu</h1>
                </div>
            </div>
        </div>
    </div>
</section>


<div sec:authorize="hasRole('ROLE_COMPANY')" class="hero-wrap hero-wrap-2" th:style="'background-image: url('+@{/assets/images/bg_1.jpg}+');'" data-stellar-background-ratio="0.5">
  <div class="overlay"></div>
  <div class="container">
    <div class="row no-gutters slider-text align-items-end justify-content-start">
      <div class="col-md-12 text-center mb-5">
        <p class="breadcrumbs mb-0"><span class="mr-3"><a href="/">Trang chủ <i class="ion-ios-arrow-forward"></i></a></span>Công việc <span></span></p>
        <h1 class="mb-3 bread">Danh sách ứng cử viên</h1>
      </div>
    </div>
  </div>
</div>

<section sec:authorize="hasRole('ROLE_COMPANY')"  class="ftco-section bg-light" >
  <div class="container">
    <div class="row">
      <div class="col-lg-12 pr-lg-5">
        <div class="row">
           <th:block th:each="applyPost : ${listApplies.content}">
            
            
            <div class="col-md-12" style="box-shadow: rgba(0, 0, 0, 0.4) 0px 0px 10px;margin: 20px auto;">
              <div class="team d-md-flex p-4 bg-white">
                <IMG style="margin-top: 10px" class="img" th:src="${applyPost.user.avatar == null} ? @{'https://st.quantrimang.com/photos/image/072015/22/avatar.jpg'} : @{'/assets/images/' + ${applyPost.user.avatar}}"></IMG>
                
             
                <div class="text pl-md-4">
                  <H5 class="location mb-0" th:text="${applyPost.user.fullName}"></H5>
                  <p style="display: block;color: black" th:text="${applyPost.user.address}"></p>
                  <span class="position" style="display: block;color: black" th:text="${applyPost.user.email}"></span>
                  <p class="mb-4" style="width: 700px" th:utext="${applyPost.user.description}">.</p>
                  <div th:if="${applyPost.nameCv != null}" style="margin-left: 1px" class="d-flex justify-content-evenly" >
                    
                    <a th:href="@{'/user/files/' + ${applyPost.user.id} + '/' + ${applyPost.nameCv}}">
                    <button class="btn btn-primary btn-md btn-file" style="width: 200px;" type="button">Download</button> </a>
                    
                    <a th:href="@{'/user/pdf/'+0+'/'+${applyPost.nameCv}}" target="_blank" style="color: ghostwhite; text-decoration: none" type="application/pdf">
                    <button class="btn btn-primary btn-md btn-file" style="width: 200px;" type="button">Xem</button></a>
                    
                    
                    <button class="btn btn-primary btn-md btn-file" style="width: 200px;" type="button" data-toggle="modal" th:attr="data-target='#aModelAccessApply'+${applyPost.id}">Duyệt cv</button>
                    
                  </div>
                </div> 
              
                
                  <div class="modal fade" th:id="'aModelAccessApply' + ${applyPost.id}" tabindex="-1"role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="aModelAccessApply"> </h5>
                                Duyệt CV
                            <button type="button" class="close" data-dismiss="modal"aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="mb-3">
                          <div class="d-flex justify-content-evenly  align-items-center" style="margin-top: 15px">
                            <ul class="st">
                                <li>Tên :</li>
                                <li>Email :</li>
                                <li>CV đã gửi :</li>
                                <li>Trạng thái :</li>
                            </ul>
                            <ul class="st">
                                <li th:text="${applyPost.user.fullName}"></li>
                                <li th:text="${applyPost.user.email}"></li>
                                <li th:text="${applyPost.nameCv}"></li>
                                <li th:if="${applyPost.status != true}"> Chưa duyệt</li>
                                <li th:if="${applyPost.status == true}"> Đã duyệt</li>
                            </ul>

                          </div>
                            <div class="d-flex justify-content-around align-items-center"  style="margin-top: 15px">
                              	<button type="button" class="btn btn-secondary mr-3" style="width: 15rem" data-dismiss="modal"aria-label="Close"><span aria-hidden="true">Đóng</span></button>
                              	<button type="submit" id="myBtn" class="btn btn-block btn-success btn-md" style="width: 15rem" th:onclick="'applyCv(' +${applyPost.id}+ ')'"> Duyệt</button>    
                        		<input type="hidden" th:id="${'idAj'}+${applyPost.id}" th:value="${applyPost.id}">	
                          </div>  
                        </div>
                      </div>
                    </div>
                  </div> 

              </div> 
            </div>
          </th:block> 
        </div>

        


        <div th:fi="${listApplies.totalPages < 1}"style="text-align: center" th:if="${listApplies.totalPages < 1}"><p style="color:red;">Không có kết quả nào.</p></div> 
        <div th:unless="${listApplies.totalPages < 1}" class="row mt-5">
          <div class="col text-center">
              <div class="block-27">
                  <ul>
                     <li th:if="${listApplies.number != 0  }">
                      <a th:href="@{/apply/list-user(page = ${listApplies.number})}">&lt;</a>
                      </li>
                      <th:block th:each="ar,state  : ${arr}">
                          <li th:class="${listApplies.number == state.index  ? 'active' : null}">
                              <a th:href="@{/apply/list-user(page = ${state.index +1 })}" th:text="${state.index + 1}"></a>
                          </li>
                      </th:block> 
                      <li th:if="${listApplies.number != numberPage-1 }">
                          <a th:href="@{/apply/list-user(page = ${listApplies.number + 2})}">&gt;</a>
                      </li>
                  </ul> 
              </div>
          </div>
        </div> 
      </div>    
    </div>
  </div>
</section>

<script>
function applyCv(id) {
	var name = "#idAj" + id;
	var idAj = $(name).val();
	var formData = new FormData();

	console.log('idAj :', idAj)
	console.log('name :', name)

	formData.append('idAj', idAj);
	$.ajax({
		type : 'POST',
		url : '/apply/access',
		contentType : false,
		processData : false,
		data : formData,
		success : function(data) {
			console.log(data);
			if (data == "false") {
				swal({
					title : 'Bạn cần phải đăng nhập!',
					/* text: 'Redirecting...', */
					icon : 'error',
					timer : 3000,
					buttons : true,
					type : 'error'
				})
			} else if (data == "true") {
				swal({
					title : 'Duyệt thành công!',
					/* text: 'Redirecting...', */
					icon : 'success',
					timer : 3000,
					buttons : true,
					type : 'success'
				})
			} else if (data == "exist") {
				swal({
					title : 'Đã duyệt !',
					/* text: 'Redirecting...', */
					icon : 'error',
					timer : 3000,
					buttons : true,
					type : 'error'
				})
			} else {
				swal({
					title : 'Bạn đã duyệt!',
					/* text: 'Redirecting...', */
					icon : 'error',
					timer : 3000,
					buttons : true,
					type : 'error'
				})
			}
		},
		error : function(err) {
			alert(err);
		}
	})
}
  
</script>



	<footer th:replace="~{public/fragments :: footer}"
		class="ftco-footer ftco-bg-dark ftco-section"> </footer>
</body>
</html>